___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Studyportals Pixel",
  "description": "Receive data insights about what international students are interested in, what information they need, how they search for their degree options, where they come from and more",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/jpeg;base64,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\u003d",
    "displayName": "Custom templated created by PRETEC team",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "This is the value of the \"id\u003d\" parameter",
    "displayName": "Account ID",
    "simpleValueType": true,
    "name": "account_id",
    "type": "TEXT",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversion_value",
    "displayName": "Conversion value",
    "simpleValueType": true,
    "help": "This is the value of the \"val\u003d\" parameter",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversion_comission",
    "displayName": "Conversion comission",
    "simpleValueType": true,
    "help": "This is the value of the \"com\u003d\" parameter",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversion_comission_percentage",
    "displayName": "Conversion comission percentage",
    "simpleValueType": true,
    "help": "This is the value of the \"comperc\u003d\" parameter",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversion_parameter",
    "displayName": "Custom conversion parameter",
    "simpleValueType": true,
    "help": "This is the value of the \"param\u003d\" parameter. Custom parameter to store along with each conversion. Leave it blank if you don\u0027t need to specify any custom parameter"
  },
  {
    "type": "CHECKBOX",
    "name": "logDebug",
    "checkboxText": "Log debug messages",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const sendPixel = require('sendPixel');
const queryPermission = require('queryPermission');
const generateRandom = require('generateRandom');
const encodeUriComponent = require('encodeUriComponent');

const id = data.account_id;
const val = data.conversion_value;
const com = data.conversion_comission;
const comperc = data.conversion_comission_percentage;
const param = data.conversion_parameter || 'empty'; //default value for param must be 'empty'

const random = generateRandom(0, 2147483647); //used for cache busting

const pixelUrl = 'https://www.clickmeter.com/conversion.aspx';
const trackingUrl = pixelUrl + '?id=' + encodeUriComponent(id) + '&val=' + encodeUriComponent(val) + '&param=' + encodeUriComponent(param) + '&com=' + encodeUriComponent(com) + '&comperc=' + encodeUriComponent(comperc) + '&gtmcb=' + random;

if(queryPermission('send_pixel', pixelUrl)) {
  sendPixel(trackingUrl, data.gtmOnSuccess, data.gtmOnFailure);
} else if(data.logDebug) { // when permissions are lacking, log to console
	logToConsole('Pixel failed due to lack of permissions for the url: ' + pixelUrl);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://www.clickmeter.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Developed by: Alfonso, Brais and Txema


